@import "global-variables";

@include keyframes(pulse) {
	0% {
		@include opacity(1);
	}
	100% {
		@include opacity(.4);
	}
}

@include keyframes(border-highlight) {
	0% {
		@include box-shadow(0 0 0 8px rgba($text-link, 0));
	    border: 1px solid $gigamacro-border-color;
	}
	50% {
		@include box-shadow(0 0 0 8px rgba($text-link, 1));
		border: 1px solid $gigamacro-legend-bg-color;
	}
	100% {
		@include box-shadow(0 0 0 8px rgba($text-link, 0));
		border: 1px solid $gigamacro-border-color;
	}
}

html, body {
	margin: 0;
	padding: 0;
	min-height: 100%;
	height: 100%;
	position: relative;
}

.node-type-gigamacro-specimen {
	$easing: cubic-bezier(.215,.61,.355,1);

	.no-animation {
		@include transition(none !important);
	}

	background-repeat: no-repeat;
	background-position: center center;
	@include background-image-retina(loader/50, gif, 50px, 50px);

	#top-level-nav-wrapper,
	header,
	.tabs,
	footer,
	.leaflet-control-attribution,
	#content > article,
	#content > #main-content {
		display: none;
	}

	// animation optimization
	#legend,
	.calacademy-pin div,
	.calacademy-pin .background-drop,
	.calacademy-pin .shadow,
	#minimap {
		@include transform(translateZ(0));
	}

	.leaflet-container img {
		overflow: hidden;
	}

	#content {
		padding: 0;
		overflow: hidden;
		position: absolute;
		width: 100%;
		max-width: inherit;
	    top: 0;
	    bottom: 0;
	    left: 0;
	    right: 0;
	    top: $navHeight;

	    @include respond-to(smartphone) {
	    	top: $smartphoneNavHeight;
	    }

	    // override some leaflet css for a slower zoom animation
	    .slow-zoom & {
	    	.leaflet-zoom-anim {
				.leaflet-zoom-animated {
					@include transition(
						transform 1.1s cubic-bezier(0,0,0.25,1)
					);
				}
			}
	    }

	    #legend {
	    	@include border-top-right-radius(125px);
	    	@include border-bottom-left-radius(125px);
	    	padding-bottom: 80px;

	    	position: absolute;
	    	width: 300px;
	    	z-index: 2;
	    	background-color: $gigamacro-legend-bg-color;
	    	border: 1px solid $gigamacro-border-color;
	    	left: $padding;
	    	overflow-y: hidden;

			@include transition(
				height .6s $easing
			);

	    	.return {
	    		margin: 0;
	    		padding: $padding;

	    		a {
	    			font-size: 1.2em;
	    			font-weight: $medium;

	    			@include box-sizing(border-box);
					padding-top: 5px;
					height: 34px;
					display: block;
					background-repeat: no-repeat;
					background-position: 0 center;
					padding-left: 44px;
					@include background-image-retina(gigamacro/arrow-left, png, 34px, 34px);
	    		}
	    	}

	    	h1, h2, #dynamic {
	    		margin: 0;
	    		margin-left: $padding;
	    		margin-right: $padding;
	    	}

	    	& > *:empty,
	    	.empty,
	    	.commenter *:empty,
	    	.pin_stuff {
	    		display: none;
	    	} 

	    	&.pin-details {
	    		&.highlight {
	    			@include animation(border-highlight 1s $easing);
	    		}

	    		.pin_stuff {
	    			display: block;

	    			&:empty,
	    			&.empty {
	    				display: none;
	    			}
	    		}
	    	}

	    	.common_name {
	    		font-weight: $medium;
	    		color: $text-link;
	    	}

	    	.scientific_name {
	    		font-style: italic;
	    		font-weight: $book;
	    		font-size: 1em;
	    		margin-top: -5px;
	    	}

	    	#dynamic {
	    		@include transition(
	    			opacity 1.5s $easing .1s
	    		);

				.details {
		    		margin-top: $padding;
		    		margin-bottom: $padding;
		    		font-size: 16px;
		    	}

		    	.pin_title {
		    		color: $text-link;
		    		padding-top: $padding;
		    		padding-left: 42px + ($padding / 2);
		    		background-repeat: no-repeat;
		    		background-position: -4px ($padding - 4);
		    		min-height: 48px;
		    		background-image: url($assetPath + '/gigamacro/pin.svg');

		    		border-top: 3px solid rgba($gigamacro-border-color, .5);
		    		margin-top: $padding;
		    		font-size: 1.5em;
		    		line-height: 1.2em;
		    		font-weight: $medium;
		    	}

		    	.commenter {
		    		margin-bottom: $padding;

		    		div {
		    			margin-left: 0;
		    		}

		    		.name {
		    			font-weight: $semibold;
		    		}
		    	}
	    	}
	    }

	    .slider-container,
    	.leaflet-control-zoom {
			a {
				border: none;
				margin-left: auto;
				margin-right: auto;
				background-color: transparent;
				@include hide-text-calacademy;

				$zoomSize: 39px;
				
				width: $zoomSize;
				height: $zoomSize;
				@include background-image-retina(gigamacro/zoom-in, png, $zoomSize, $zoomSize);

				&.leaflet-control-zoom-out {
					@include background-image-retina(gigamacro/zoom-out, png, $zoomSize, $zoomSize);	
				}

				&:last-child {
					margin-top: 14px;
				}

				&.control-refresh {
					margin-bottom: 30px;
					width: 48px;
					height: 48px;
					@include background-image-retina(gigamacro/reset, png, 48px, 48px);
				}

				&.leaflet-disabled {
					@include opacity(0.6);
					@include disable-link;
				}
			}

			@include box-shadow(none);
		}

		.leaflet-control-zoom {
	    	margin-right: 36px;
			margin-top: 36px;
			border: none !important;

			a {
				display: none;

				&.control-refresh {
					display: block;
				}
			}
	    }

	    .slider-container {
	    	// @include transform(rotate(180deg));

	    	position: absolute;
	    	z-index: 3;
	    	left: 0;
	    	right: 0;
	    	bottom: 36px;

	    	width: 48%;
	    	margin-left: auto;
	    	margin-right: auto;

	    	padding: 10px;
	    	background-color: $gigamacro-legend-bg-color;
	    	border: 1px solid $gigamacro-border-color;
	    	@include border-radius(30px);

	    	a,
	    	#slider {
	    		float: left;

	    		&.leaflet-control-zoom-in {
	    			float: right;
	    		}
	    	}

	    	a {
	    		margin: 0 !important;
	    	}

	    	#slider {	    		
	    		margin-top: 15px;
	    		margin-left: 25px;
	    		@include calc(width, (100% - #{130px}), 70%);
	    		background-color: #ebebeb;
	    		border: 1px solid #e0e0e0;
	    		height: 5px;

	    		span {
	    			@include transition(
	    				transform .4s $easing,
	    				left .4s $easing
	    			);

	    			border: 0;
	    			@include border-radius(0);
	    			@include hand-cursor;

	    			background-color: transparent;
	    			padding: 30px;
	    			padding-left: 0;
	    			
	    			top: 0;
	    			@include transform(translateY(-50%));
	    			
	    			div {
	    				position: absolute;
	    				top: 26px;
	    				left: 0;
	    				background-color: #006ad0;
		    			height: 30px;
		    			width: 10px;
		    			@include border-radius(5px);
	    			}
	    		}
	    	}
	    }

	    #fingers {
	    	z-index: 4;
	    	position: absolute;
	    	color: #b9b9b9;
	    	font-weight: $book;
	    	font-size: 22px;
		    pointer-events: none;

		    top: 50%;
		    @include calc(left, (50% + #{280px}), 70%);
		    @include transform(translateY(-50%));

		    // fade in/out
		    @include transition(
	    		opacity .4s ease-in
	    	);	

		    @include opacity(0);

		    div {
		    	height: 100px;
		    	padding-top: 55px;
	    		padding-left: 100px;
		    	background-repeat: no-repeat;
		    	background-image: url($assetPath + '/gigamacro/fingers.svg');

		    	// pulse
		    	&.pulse {
		    		@include animation(pulse .8s ease-in 0 infinite alternate);	
		    	}
		    }
	    }

		.leaflet-container {
			z-index: 1;

			&, * {
	    		-webkit-touch-callout: none;
				@include user-select(none);
	    	}

			height: 100%;
			background-color: #ffffff !important;

			.calacademy-pin {
				.svg-container,
				.shadow {
					pointer-events: none;
				}

				.svg-container {
					position: relative;
					z-index: 2;

					margin-left: auto;
					margin-right: auto;
					width: 50px;
					height: 58px;

					@include transition(
						transform .3s $easing
					);

					@include calacademy-transform-origin(center, bottom);
					@include transform(scale(.6));

					svg {
						.background-drop {
							@include transition(
								transform .3s $easing
							);

							@include calacademy-transform-origin(center, 30%);
							fill: rgba(#6bb8ef, .8);
						}
					}
				}

				.shadow {
					@include transition(
						transform .3s $easing,
						left .3s $easing,
						top .3s $easing
					);

					@include transform(scale(.6));

					position: absolute;
					left: -40px;
					top: -30px;
					z-index: 1;
					@include hide-text-calacademy;

					width: 157px;
					height: 140px;

					background-repeat: no-repeat;
					background-size: contain;
					background-image: url($assetPath + '/gigamacro/pin-shadow.png');
				}

				&.selected {
					.svg-container {
						// scale up the pin
						@include transform(scale(1));

						// scale back the "stroke"
						svg {
							.background-drop {
								@include transform(scale(.8));
							}
						}
					}

					// scale and offset the shadow
					.shadow {
						@include transform(scale(1));
						left: -35px;
						top: -40px;
					}
				}
			}
		}

		.leaflet-bottom.leaflet-right {
			@include calacademy-transform-origin(bottom, right);
			@include transform(scale(.5));

			.leaflet-control-minimap {
				@include transition(none !important);
				@include box-shadow(none);
				@include border-radius(0);
				margin-right: 0;
				margin-bottom: 0;
				border: 0;

				@include opacity(.975);
			}
		}

		#minimap-bg {
			position: absolute;
			bottom: 0;
			right: 0;
			
			border: 1px solid $gigamacro-border-color;
			border-bottom: 0;
			border-right: 0;
			background-color: #000000;
		}
	}

	.floor & {
		nav {
			display: none;
		}

		#content {
			top: 0;
		}	
	}
}
