@import "global-variables";

html, body {
	margin: 0;
	padding: 0;
	min-height: 100%;
	height: 100%;
	position: relative;
}

.node-type-gigamacro-specimen {
	$padding: 35px;
	$easing: cubic-bezier(.215,.61,.355,1);

	#leaflet-map-container {
		width: 100%;
		height: 100%;
		position: relative;
	}

	.no-animation {
		@include transition(none !important);
	}

	.leaflet-container,
	.slider-container,
	.leaflet-control-zoom,
	#legend,
	#bubble {
		&, * {
    		-webkit-touch-callout: none;
			@include user-select(none);
    	}
	}

	background-repeat: no-repeat;
	background-position: center center;
	@include background-image-retina(loader/50, gif, 50px, 50px);

	#top-level-nav-wrapper,
	header,
	.tabs,
	footer,
	.leaflet-control-attribution,
	#content > article,
	#content > #main-content {
		display: none;
	}

	// animation optimization
	.calacademy-pin div,
	.calacademy-pin .background-drop,
	.calacademy-pin .shadow {
		@include transform(translateZ(0));
	}

	.leaflet-container img {
		overflow: hidden;
	}

	#content {
		padding: 0;
		overflow: hidden;
		position: absolute;
		width: 100%;
		max-width: inherit;
	    top: 0;
	    bottom: 0;
	    left: 0;
	    right: 0;
	    top: $navHeight;

	    @include respond-to(smartphone) {
	    	top: $smartphoneNavHeight;
	    }

	    // override some leaflet css for a slower zoom animation
	    .slow-zoom & {
	    	.leaflet-zoom-anim {
				.leaflet-zoom-animated {
					@include transition(
						transform 1.1s cubic-bezier(0,0,0.25,1)
					);
				}
			}
	    }

	    #bubble,
	    #legend,
	    .slider-container {
	    	background-color: $gigamacro-legend-bg-color;
	    	border: 1px solid $gigamacro-border-color;
	    }

	    #bubble,
	    #legend {
	    	overflow-y: hidden;

			@include transition(
				height .6s $easing
			);

	    	.dynamic {
	    		@include transition(
	    			opacity 1.5s $easing .1s
	    		);

	    		.pin_stuff {
	    			display: block;

	    			&:empty,
	    			&.empty {
	    				display: none;
	    			}
	    		}

				.details {
		    		margin-top: $padding;
		    		margin-bottom: $padding;
		    		font-size: 16px;
		    	}

		    	.pin_title {
		    		color: $text-link;
		    		padding-top: $padding + 3px;
		    		padding-left: 42px + ($padding / 2);
		    		background-repeat: no-repeat;
		    		@include background-size(51px 65px);
		    		background-position: -4px ($padding - 4);
		    		min-height: 55px;
		    		background-image: url($assetPath + '/gigamacro/pin.svg');

		    		border-top: 3px solid rgba($gigamacro-border-color, .5);
		    		margin-top: $padding;
		    		font-size: 1.5em;
		    		line-height: 1.2em;
		    		font-weight: $medium;
		    	}

		    	.commenter {
		    		margin-top: 20px;

		    		.name {
		    			font-weight: $semibold;
		    		}
		    	}
	    	}
	    }

	    #bubble {
	    	@include box-sizing(border-box);
	    	@include border-top-left-radius(50px);
	    	@include border-bottom-right-radius(50px);

	    	position: absolute;
	    	z-index: 5;	    	
	    	
	    	width: 35%;
	    	max-width: 660px;

	    	padding: $padding;
	    	overflow: visible;
	    	pointer-events: none;
	    	@include opacity(0);
	    	right: 11%;
	    	
	    	$bubbleTop: 200px;
	    	$bubbleTopOffset: 30px;
	    	
	    	top: $bubbleTop + $bubbleTopOffset;

	    	@include transition(
	    		opacity .5s $easing,
	    		height .6s $easing,
	    		top .7s $easing,
	    		transform .7s $easing
	    	);

	    	&.show {
	    		@include opacity(1);
	    		pointer-events: auto;
	    		top: $bubbleTop;
	    	}

	    	.csstransforms3d & {
	    		top: auto !important;
	    		@include transform(translate3d(0, $bubbleTop + $bubbleTopOffset, 0));

	    		&.show {
	    			@include transform(translate3d(0, $bubbleTop, 0));
	    		}
	    	}

    		&.highlight {
    			@include animation(gigamacro-border-highlight 1s $easing);
    		}

    		.close {
    			display: block;
    			z-index: 6;
    			position: absolute;
    			right: -20px;
    			top: -20px;

    			$s: 39px;
    			width: $s;
    			height: $s;
    			@include hand-cursor;
    			@include hide-text-calacademy;
    			@include background-image-retina(gigamacro/zoom-in, png, $s, $s);
    			@include transform(rotate(45deg));
    			@include calacademy-transform-origin(center, center);
    		}

    		.dynamic {
	    		.details {
	    			margin: 0;
	    			padding: 0;
	    		}
    		}
	    }

	    #legend {
	    	@include animation(fade-in-from-top .6s $easing);
	    	@include border-top-right-radius(125px);
	    	@include border-bottom-left-radius(125px);
	    	padding-bottom: 80px;

	    	position: absolute;
	    	width: 300px;
	    	z-index: 2;
	    	left: $padding;

	    	.return {
	    		margin: 0;
	    		padding: $padding;
	    		padding-bottom: 20px;

	    		a {
	    			font-size: 1.2em;
	    			font-weight: $medium;

	    			@include box-sizing(border-box);
					padding-top: 5px;
					height: 34px;
					display: block;
					background-repeat: no-repeat;
					background-position: 0 center;
					padding-left: 44px;
					@include background-image-retina(gigamacro/arrow-left, png, 34px, 34px);
	    		}
	    	}

	    	h1, h2, .dynamic {
	    		margin: 0;
	    		margin-left: $padding;
	    		margin-right: $padding;
	    	}

	    	& > *:empty,
	    	.empty,
	    	.commenter *:empty,
	    	.pin_stuff {
	    		display: none;
	    	}

	    	.common_name {
	    		font-weight: $medium;
	    		color: $gigamacro-blue;
	    		font-size: 3em;
	    		letter-spacing: -1px;
	    	}

	    	.scientific_name {
	    		font-style: italic;
	    		font-weight: $book;
	    		margin-top: -5px;
	    	}
	    }

	    .slider-container,
    	.leaflet-control-zoom {
			a {
				border: none;
				margin-left: auto;
				margin-right: auto;
				background-color: transparent;
				@include hide-text-calacademy;

				$zoomSize: 39px;
				
				width: $zoomSize;
				height: $zoomSize;
				@include background-image-retina(gigamacro/zoom-in, png, $zoomSize, $zoomSize);

				&.leaflet-control-zoom-out {
					@include background-image-retina(gigamacro/zoom-out, png, $zoomSize, $zoomSize);	
				}

				&:last-child {
					margin-top: 14px;
				}

				&.leaflet-disabled {
					@include opacity(0.6);
					cursor: default;
				}
			}

			@include box-shadow(none);
		}

		.leaflet-control-zoom {
	    	margin-right: $padding;
			margin-top: $padding;
			border: none !important;

			a {
				display: none;
			}
	    }

	    .slider-container {
	    	@include animation(fade-in-from-bottom .6s $easing);
	    	// @include transform(rotate(180deg));

	    	position: absolute;
	    	z-index: 3;
	    	left: 0;
	    	right: 0;
	    	bottom: 36px;

	    	width: 48%;
	    	margin-left: auto;
	    	margin-right: auto;

	    	padding: 10px;
	    	@include border-radius(30px);

	    	a,
	    	#slider {
	    		float: left;

	    		&.leaflet-control-zoom-in {
	    			float: right;
	    		}
	    	}

	    	a {
	    		z-index: 3;
	    		position: relative;
	    		margin: 0 !important;
	    	}

	    	#slider,
	    	#slider-bg {
	    		@include calc(width, (100% - #{130px}), 70%);
	    		position: absolute;
	    		left: 0;
	    		right: 0;
	    		margin-left: auto;
	    		margin-right: auto;
	    	}

	    	#slider-bg {
	    		z-index: 1;

	    		pointer-events: none;
	    		background-color: #ebebeb;
	    		border: 1px solid #e0e0e0;
	    		height: 5px;
	    		top: 25px;
	    		@include border-radius(3px);
	    	}

	    	#slider {
	    		z-index: 2;

	    		@include hand-cursor;
	    		height: 100%;
	    		top: 0;
	    		bottom: 0;

	    		border: none;
	    		background-color: transparent;

	    		span {
	    			@include transition(
	    				transform .4s $easing,
	    				left .4s $easing
	    			);

	    			border: 0;
	    			@include border-radius(0);
	    			@include hand-cursor;

	    			background-color: transparent;
	    			// background-color: rgba(green, .5);
	    			
	    			padding: 30px;
	    			padding-left: 0;
	    			top: -12px;
	    			
	    			div {
	    				position: absolute;
	    				top: 26px;
	    				left: 0;
	    				background-color: #006ad0;
		    			height: 30px;
		    			width: 10px;
		    			@include border-radius(5px);
	    			}
	    		}
	    	}
	    }

	    #fingers {
	    	z-index: 4;
	    	position: absolute;
	    	color: #b9b9b9;
	    	font-weight: $book;
	    	font-size: 22px;
		    pointer-events: none;

		    top: 50%;
		    @include calc(left, (50% + #{280px}), 70%);
		    @include transform(translateY(-50%));

		    // fade in/out
		    @include transition(
	    		opacity .4s ease-in
	    	);	

		    @include opacity(0);

		    div {
		    	height: 100px;
		    	padding-top: 55px;
	    		padding-left: 100px;
		    	background-repeat: no-repeat;
		    	background-image: url($assetPath + '/gigamacro/fingers.svg');

		    	// pulse
		    	&.pulse {
		    		@include animation(pulse .8s ease-in 0 infinite alternate);	
		    	}
		    }
	    }

		.control-refresh {
			z-index: 997;
			position: absolute;
			top: $padding;
			right: $padding;

			display: block;
			width: 97px;
			height: 58px;
			@include hide-text-calacademy;
			@include animation(fade-in-from-top .6s $easing);
			@include background-image-retina(gigamacro/reset, png, 97px, 58px);
		}

		.leaflet-container {
			z-index: 1;
			height: 100%;
			background-color: #ffffff !important;

			.calacademy-pin {
				@include animation(fade-in 1s $easing);
				@include border-radius(40px);
				@include hand-cursor;

				background-color: rgba(0, 0, 0, 0);

				.pin-bg & {
					background-color: rgba(0, 255, 255, .5);
				}

				.svg-container,
				.shadow {
					pointer-events: none;
				}

				.svg-container {
					position: relative;
					z-index: 2;

					margin-left: auto;
					margin-right: auto;
					width: 51px;
					height: 65px;

					@include transition(
						transform .3s $easing
					);

					@include calacademy-transform-origin(center, bottom);
					@include transform(scale(.6));

					svg {
						.background-drop {
							@include transition(
								transform .3s $easing
							);

							@include calacademy-transform-origin(center, 30%);
							fill: rgba(#6bb8ef, .8);
						}
					}
				}

				.shadow {
					@include transition(
						transform .3s $easing,
						left .3s $easing,
						top .3s $easing
					);

					@include transform(scale(.6));

					position: absolute;
					left: -40px;
					top: -30px;
					z-index: 1;
					@include hide-text-calacademy;

					width: 157px;
					height: 140px;

					background-repeat: no-repeat;
					@include background-size(contain);
					background-image: url($assetPath + '/gigamacro/pin-shadow.png');
				}

				&.selected {
					.svg-container {
						// scale up the pin
						@include transform(scale(1));

						// scale back the "stroke"
						svg {
							.background-drop {
								@include transform(scale(.8));
							}
						}
					}

					// scale and offset the shadow
					.shadow {
						@include transform(scale(1));
						left: -35px;
						top: -40px;
					}
				}
			}
		}

		.leaflet-bottom.leaflet-right {
			@include calacademy-transform-origin(bottom, right);
			@include transform(scale(.5));

			.leaflet-control-minimap {
				@include transition(none !important);
				@include box-shadow(none);
				@include border-radius(0);
				margin-right: 0;
				margin-bottom: 0;
				border: 0;

				@include opacity(.975);
			}
		}

		#minimap-bg {
			position: absolute;
			bottom: 0;
			right: 0;
			
			border: 1px solid $gigamacro-border-color;
			border-bottom: 0;
			border-right: 0;
			background-color: #000000;
		}
	}

	.floor & {
		nav {
			display: none;
		}

		#content {
			margin: 0 !important;
			top: 0;
		}	
	}

	// smartphone
	#smartphone-legend,
	#smartphone-return,
	#smartphone-legend-toggle {
		display: none;
	}

	@include respond-to(smartphone) {
		#leaflet-map-container {
			@include transition(
				transform .5s $easing
			);

			@include transform(translate3d(0, 0, 0));

			.smartphone-dock-open & {
				@include transform(translate3d(0, -50px, 0));
			} 
		}

		.smartphone-stuff {
			display: block !important;
		}

		#bubble,
		#legend,
		#fingers,
		.slider-container,
		.pin_title,
		.leaflet-bottom.leaflet-right,
		#minimap-bg {
			display: none;
		}

		#smartphone-return,
		#smartphone-legend,
		#smartphone-legend-toggle {
			width: 100%;
			z-index: 998;
			position: absolute;
		}

		#smartphone-return {
			top: $smartphonePadding;
			left: $smartphonePadding;
			font-weight: $semibold;
		}

		#smartphone-legend,
		#smartphone-legend-toggle {
			background-color: $gigamacro-legend-bg-color;
		}

		#smartphone-legend {
			border-top: 1px solid $gigamacro-border-color;

			@include transition(
				top .6s $easing,
				transform .6s $easing
			);

			&, h1, h2 {
				margin: 0;
				@include box-sizing(border-box);
			}

			h1, h2, .dynamic {
				padding-left: $smartphonePadding;
				padding-right: $smartphonePadding;
			}

			h1, h2 {
				font-weight: $medium;
				font-size: $smartphoneText;
				line-height: $smartphoneLineHeight;
			}

			h1 {
				padding-top: $smartphonePadding;
				font-weight: $semibold;
			}

			h2 {
				font-style: italic;
			}

			.dynamic {
				@include transition(
					opacity .5s $easing
				);

				.empty {
					display: none;
				}

				padding-top: $smartphonePadding;
				padding-bottom: $smartphonePadding;
				font-size: $slightlyLargerText;
				line-height: $slightlyLargerTextLineHeight;

				.commenter {
					.name {
						font-weight: $semibold;
					}

					font-size: $defaultText;
					line-height: $defaultLineHeight;
					padding-top: $smartphonePadding;
				}
			}
		}

		#smartphone-legend-toggle {
			bottom: 0;
			@include box-sizing(border-box);
			padding: $smartphonePadding;
			text-align: center !important;

			@include transition(
				border-color .5s $easing
			);

			border-top: 1px solid $gigamacro-legend-bg-color;

			.smartphone-dock-open & {
				border-color: $gigamacro-border-color;
			}

			a {
				display: inline-block;

				span,
				.chevron {
					float: left;
				}

				span {	
					font-weight: $semibold;
					font-size: 16px;				
				}

				.chevron {
					@include transform(translate3d(0, 0, 0));
					display: block;
					margin-top: 7px;
					margin-left: 4px;

					$w: 8px;

					width: $w;
					height: $w;
					@include hide-text-calacademy;
					@include background-image-retina(chevron-small-blue, png, $w, $w);
				}
			}
		}
	}
}
